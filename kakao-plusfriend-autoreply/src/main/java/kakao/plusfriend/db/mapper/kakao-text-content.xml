<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kakaoTextReply">
	  <select id="selectRegularContent" parameterType="kakao.plusfriend.autoreply.vo.kakaoVO" resultType="java.util.Map">
	    with tbl_regular as (
		    select 
		        reg_id,
		        reg_content
		    from
		        tbl_kakao_reg_contents
		    where
		         #{content} like '%' || reg_content || '%'
		)
		
		SELECT DISTINCT
		    txt_content 
		FROM 
		    tbl_regular reg
		    inner join tbl_kakao_text_regular_link link
		    on reg.reg_id = link.reg_id
		    inner join tbl_kakao_text_contents txt
		    on txt.txt_id = link.txt_id
	  </select>
	  
	  
	  <select id="selectTextAndRegularContentsList" parameterType="kakao.plusfriend.web.vo.contentVO" resultType="java.util.Map">
	  	with tbl_regular as (
		    select 
		        reg_id,
		        reg_content
		    from
		        tbl_kakao_reg_contents
		    where
		    	1=1 
		    	<if test="reg_content != '' and reg_content != null">
		        and #{reg_content} like '%' || reg_content || '%'
		        </if>
		)
		
		SELECT 
			reg_content,
		    txt_content 
		FROM 
		    tbl_regular reg
		    inner join tbl_kakao_text_regular_link link
		    on reg.reg_id = link.reg_id
		    inner join tbl_kakao_text_contents txt
		    on txt.txt_id = link.txt_id
	  </select>
	  
	  
	  <insert id="insertKakaoTextContent" parameterType="kakao.plusfriend.web.vo.contentVO">
	  	insert into 
	  	tbl_kakao_text_contents(
	  		txt_content	
	  	) values (
	  		#{txt_content}
	  	)
	  </insert>
	  
	  <insert id="insertKakaoRegContent" parameterType="kakao.plusfriend.web.vo.contentVO">
	  	insert into 
	  	tbl_kakao_reg_contents(
	  		reg_content	
	  	) values (
	  		#{reg_content}
	  	)
	  </insert>
	  
	  <insert id="insertKakaoTextLink" parameterType="kakao.plusfriend.web.vo.contentVO">
	  	insert into 
	  	tbl_kakao_text_regular_link(
	  		txt_id,
	  		reg_id
	  	) values (
	  		#{txt_id},
	  		#{reg_id}
	  	)
	  </insert>
	  
	  <select id="selectTextList" resultType="java.util.Map">
	  select
	  	txt_id,
	  	txt_content
	  from 
	  	tbl_kakao_text_contents
	  </select>
	  
	  <select id="selectRegularList" resultType="java.util.Map">
	  select
	  	reg_id,
	  	reg_content
	 from 
	  	tbl_kakao_reg_contents
	  </select>
	  
	  <select id="selectTextJoinRegularList" resultType="java.util.Map">
	  select
		    txt.txt_content,
		    reg.reg_content,
		    to_char(txt.create_date, 'YYYY-MM-DD HH:MI:SS') AS txt_create_date,
			to_char(txt.modify_date, 'YYYY-MM-DD HH:MI:SS') AS txt_modify_date,
		    to_char(reg.create_date, 'YYYY-MM-DD HH:MI:SS') AS reg_create_date,
			to_char(reg.modify_date, 'YYYY-MM-DD HH:MI:SS') AS reg_modify_date
		from
		    tbl_kakao_text_contents txt 
		left outer join 
		tbl_kakao_text_regular_link link 
		on txt.txt_id = link.txt_id
		right outer join      tbl_kakao_reg_contents reg 
		on reg.reg_id = link.reg_id
	  </select>
</mapper>